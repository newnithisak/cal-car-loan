<!DOCTYPE html>
<html lang="th" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Car Loan Pro - Smart Down Payment</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <script>tailwind.config = { darkMode: 'class' }</script>
    <style>
        body { font-family: 'Kanit', sans-serif; -webkit-tap-highlight-color: transparent; overflow-x: hidden; }
        .glass { background: rgba(255, 255, 255, 0.92); backdrop-filter: blur(10px); }
        .dark .glass { background: rgba(15, 23, 42, 0.95); }
        input, select { font-size: 16px !important; }
        @media (max-width: 380px) { .big-number { font-size: 2.5rem !important; } }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 min-h-screen pb-10">

    <nav class="sticky top-0 z-40 glass border-b border-slate-200 dark:border-slate-800 p-3 px-4 flex justify-between items-center">
        <div class="flex items-center gap-1.5"><span class="text-xl">üèéÔ∏è</span><span class="font-bold text-base">Car Loan Pro</span></div>
        <button onclick="toggleComparison()" class="bg-blue-600 text-white px-4 py-1.5 rounded-xl text-[11px] font-bold shadow-md">
            <span id="btn-compare-text">+ ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</span>
        </button>
    </nav>

    <main class="max-w-md mx-auto p-3 space-y-4">
        <div id="plan1" class="glass rounded-[2rem] p-4 border border-slate-200 dark:border-slate-800 shadow-lg space-y-4">
            <div class="flex justify-between items-center">
                <span class="px-2 py-0.5 bg-blue-100 dark:bg-blue-900/40 text-blue-600 text-[9px] font-bold rounded-md uppercase">‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà 1</span>
                <input type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∏‡πà‡∏ô‡∏£‡∏ñ..." class="bg-transparent border-b border-dashed text-right text-xs outline-none w-1/2">
            </div>

            <div class="space-y-4">
                <div class="space-y-0.5">
                    <label class="text-[9px] font-bold text-slate-400 uppercase">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå</label>
                    <input type="text" data-id="price" placeholder="0" oninput="formatAndCalc(this, 'plan1')" inputmode="numeric" class="w-full bg-transparent text-3xl font-bold border-b-2 border-slate-100 dark:border-slate-800 pb-1">
                </div>

                <div class="space-y-2">
                    <div class="flex justify-between items-center">
                        <label class="text-[10px] font-bold text-green-600 uppercase">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</label>
                        <button onclick="addDiscount('plan1')" class="text-[9px] bg-green-500 text-white px-2 py-1 rounded-lg font-bold shadow-sm">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</button>
                    </div>
                    <div data-id="discount-list" class="space-y-1.5"></div>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-slate-100 dark:bg-slate-900/50 p-3 rounded-2xl border border-transparent focus-within:border-blue-500">
                        <label class="text-[9px] font-bold text-slate-400 uppercase tracking-tighter">‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå <span data-id="down-percent-label" class="text-blue-500 lowercase">(0%)</span></label>
                        <input type="text" data-id="down" placeholder="0" oninput="autoSetCustom('plan1'); formatAndCalc(this, 'plan1')" inputmode="numeric" class="w-full bg-transparent font-bold text-base">
                        <select data-id="down_percent" onchange="syncDown('plan1')" class="bg-transparent text-blue-600 text-[10px] font-bold outline-none block mt-1 w-full">
                            <option value="custom" selected>‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏≠‡∏á</option>
                            <option value="15">15%</option>
                            <option value="20">20%</option>
                            <option value="25">25%</option>
                            <option value="30">30%</option>
                            <option value="35">35%</option>
                            <option value="40">40%</option>
                            <option value="45">45%</option>
                            <option value="50">50%</option>
                        </select>
                    </div>
                    <div class="bg-slate-100 dark:bg-slate-900/50 p-3 rounded-2xl border border-transparent focus-within:border-blue-500 text-right">
                        <label class="text-[9px] font-bold text-slate-400 uppercase">‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢/‡∏õ‡∏µ (%)</label>
                        <input type="text" data-id="interest" placeholder="0.00" oninput="calc('plan1')" inputmode="decimal" class="w-full bg-transparent font-bold text-base text-right">
                        <p class="text-[9px] text-orange-500 font-bold uppercase mt-1">Flat Rate</p>
                    </div>
                    <div class="col-span-2 bg-slate-100 dark:bg-slate-900/50 p-3 rounded-2xl">
                        <label class="text-[9px] font-bold text-slate-400 uppercase">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ú‡πà‡∏≠‡∏ô (‡∏õ‡∏µ)</label>
                        <select data-id="years" onchange="calc('plan1')" class="w-full bg-transparent font-bold text-base mt-1 outline-none">
                            <option value="0" selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ...</option>
                            <option value="4">4 ‡∏õ‡∏µ (48 ‡∏á‡∏ß‡∏î)</option>
                            <option value="5">5 ‡∏õ‡∏µ (60 ‡∏á‡∏ß‡∏î)</option>
                            <option value="6">6 ‡∏õ‡∏µ (72 ‡∏á‡∏ß‡∏î)</option>
                            <option value="7">7 ‡∏õ‡∏µ (84 ‡∏á‡∏ß‡∏î)</option>
                            <option value="8">8 ‡∏õ‡∏µ (96 ‡∏á‡∏ß‡∏î)</option>
                        </select>
                    </div>
                </div>

                <div class="space-y-2">
                    <div class="flex items-center justify-between p-3 bg-orange-50 dark:bg-orange-950/20 rounded-xl border border-orange-100 dark:border-orange-900/30">
                        <div class="flex-1">
                            <label class="text-[9px] font-bold text-orange-600 uppercase">‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô PPI</label>
                            <input type="text" data-id="insurance" placeholder="0" oninput="formatAndCalc(this, 'plan1')" inputmode="numeric" class="bg-transparent font-bold w-full text-base">
                        </div>
                        <label class="flex items-center gap-1.5 text-[9px] font-bold text-orange-600 cursor-pointer">
                            <input type="checkbox" data-id="inc_ins" onchange="calc('plan1')" class="w-3.5 h-3.5"> <span>‡∏£‡∏ß‡∏°‡∏Å‡∏π‡πâ</span>
                        </label>
                    </div>
                    <label class="flex items-center p-3 bg-blue-50 dark:bg-blue-950/20 rounded-xl border border-blue-100 dark:border-blue-900/30 text-[10px] font-bold text-slate-600 dark:text-slate-300 cursor-pointer">
                        <input type="checkbox" data-id="add_vat" onchange="calc('plan1')" class="mr-2 w-3.5 h-3.5">
                        <span>‡∏ö‡∏ß‡∏Å‡∏†‡∏≤‡∏©‡∏µ VAT 7% ‡πÉ‡∏ô‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î</span>
                    </label>
                </div>
            </div>

            <div class="bg-slate-900 dark:bg-blue-700 p-5 rounded-[1.75rem] text-white shadow-xl space-y-4 overflow-hidden">
                <div class="text-center">
                    <p class="text-[9px] text-slate-400 dark:text-blue-100 uppercase tracking-widest mb-1">‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</p>
                    <p class="big-number text-5xl font-black truncate"><span data-id="res-monthly">0</span></p>
                    <p class="text-[9px] text-slate-400 dark:text-blue-200 mt-1">
                        <span data-id="res-period">0</span> ‡∏á‡∏ß‡∏î | <span data-id="res-vattxt">‡∏£‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                    </p>
                </div>
                <div class="grid grid-cols-2 gap-y-3 gap-x-4 pt-4 border-t border-white/10 text-[11px]">
                    <div><p class="text-slate-400 mb-0.5 uppercase">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏£‡∏ß‡∏°</p><p data-id="res-disctotal" class="font-bold text-green-400">0</p></div>
                    <div class="text-right"><p class="text-slate-400 mb-0.5 uppercase">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</p><p data-id="res-netprice" class="font-bold text-blue-300">0</p></div>
                    <div><p class="text-slate-400 mb-0.5 uppercase">‡∏¢‡∏≠‡∏î‡∏Å‡∏π‡πâ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</p><p data-id="res-loan" class="font-bold">0</p></div>
                    <div class="text-right"><p class="text-slate-400 mb-0.5 uppercase">‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏£‡∏ß‡∏°</p><p data-id="res-int" class="font-bold text-yellow-400">0</p></div>
                </div>
                <div class="pt-3 border-t border-white/10 flex justify-between items-center">
                    <p class="text-[10px] text-slate-400 font-bold uppercase">‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô (Total Cost)</p>
                    <p data-id="res-totalall" class="text-2xl font-black text-orange-400">0</p>
                </div>
            </div>
        </div>
        <div id="plan2-container" class="hidden opacity-0 transition-all duration-300"><div id="plan2"></div></div>
    </main>

    <nav class="fixed bottom-4 left-1/2 -translate-x-1/2 h-14 glass rounded-2xl border border-slate-200 dark:border-slate-800 flex items-center px-6 gap-6 shadow-2xl z-40">
        <button onclick="toggleDarkMode()" class="text-lg">üåì</button>
        <button onclick="location.reload()" class="text-red-500 text-[10px] font-black uppercase">Reset</button>
    </nav>

    <script>
        const parse = (s) => parseFloat(s.toString().replace(/,/g, '')) || 0;
        const fmt = (n) => (isNaN(n) || n === 0) ? "0" : Math.round(n).toLocaleString();

        function formatAndCalc(el, planId) {
            let cursorPosition = el.selectionStart;
            let originalLength = el.value.length;
            let val = el.value.replace(/,/g, '');
            if (!isNaN(val) && val !== '') el.value = Number(val).toLocaleString();
            let newLength = el.value.length;
            el.selectionEnd = cursorPosition + (newLength - originalLength);
            
            if (el.dataset.id === 'price') syncDown(planId);
            calc(planId);
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì % ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
        function syncDown(planId) {
            const p = document.getElementById(planId);
            const price = parse(p.querySelector('[data-id="price"]').value);
            const dpSelect = p.querySelector('[data-id="down_percent"]');
            const dpValue = dpSelect.value;
            const downInput = p.querySelector('[data-id="down"]');
            
            let discTotal = 0;
            p.querySelectorAll('.disc-row').forEach(row => {
                const input = row.querySelector('.disc-input');
                const unit = row.querySelector('.disc-unit').value;
                discTotal += (unit === 'pct') ? (price * (parse(input.value) / 100)) : parse(input.value);
            });

            const netPrice = price - discTotal;

            if (dpValue !== 'custom' && netPrice > 0) {
                downInput.value = fmt(netPrice * (parseFloat(dpValue) / 100));
            }
            calc(planId);
        }

        function autoSetCustom(planId) {
            document.querySelector(`#${planId} [data-id="down_percent"]`).value = 'custom';
        }

        function calc(planId) {
            const p = document.getElementById(planId);
            if(!p) return;
            const price = parse(p.querySelector('[data-id="price"]').value);
            const down = parse(p.querySelector('[data-id="down"]').value);
            const intr = parse(p.querySelector('[data-id="interest"]').value);
            const yrs = parseInt(p.querySelector('[data-id="years"]').value);
            const ins = parse(p.querySelector('[data-id="insurance"]').value);
            const incIns = p.querySelector('[data-id="inc_ins"]').checked;
            const addVat = p.querySelector('[data-id="add_vat"]').checked;

            let discTotal = 0;
            p.querySelectorAll('.disc-row').forEach(row => {
                const input = row.querySelector('.disc-input');
                const unit = row.querySelector('.disc-unit').value;
                discTotal += (unit === 'pct') ? (price * (parse(input.value) / 100)) : parse(input.value);
            });

            const netPrice = price - discTotal;

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì % ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏ä‡∏ß‡πå‡πÉ‡∏ô Label
            let currentPct = 0;
            if (netPrice > 0) {
                currentPct = (down / netPrice) * 100;
            }
            p.querySelector('[data-id="down-percent-label"]').innerText = `(${currentPct.toFixed(currentPct % 1 === 0 ? 0 : 1)}%)`;

            let loan = netPrice - down;
            if (incIns) loan += ins;
            const months = yrs * 12;
            let monthly = 0, totalInt = 0;
            if (months > 0 && loan > 0) {
                totalInt = loan * (intr/100) * yrs;
                monthly = (loan + totalInt) / months;
            }
            let vatAmount = 0;
            if (addVat) { vatAmount = monthly * 0.07; monthly += vatAmount; }

            p.querySelector('[data-id="res-monthly"]').innerText = fmt(monthly);
            p.querySelector('[data-id="res-period"]').innerText = months || 0;
            p.querySelector('[data-id="res-vattxt"]').innerText = addVat ? `VAT 7% (+${fmt(vatAmount)})` : (price > 0 ? "‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏° VAT" : "‡∏£‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
            p.querySelector('[data-id="res-disctotal"]').innerText = fmt(discTotal);
            p.querySelector('[data-id="res-netprice"]').innerText = fmt(netPrice);
            p.querySelector('[data-id="res-loan"]').innerText = fmt(loan);
            p.querySelector('[data-id="res-int"]').innerText = fmt(totalInt);
            p.querySelector('[data-id="res-totalall"]').innerText = fmt(down + (monthly * (months || 0)));
        }

        function addDiscount(planId) {
            const container = document.querySelector(`#${planId} [data-id="discount-list"]`);
            const div = document.createElement('div');
            div.className = "disc-row flex gap-1.5 items-center bg-white/50 dark:bg-slate-900/50 p-1.5 rounded-xl border border-slate-200 dark:border-slate-800";
            div.innerHTML = `
                <input type="text" placeholder="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£..." class="flex-1 bg-transparent text-sm outline-none px-1 min-w-0">
                <div class="flex-[1.8] flex items-center bg-slate-100 dark:bg-slate-800 rounded-lg overflow-hidden border dark:border-slate-700 min-w-0">
                    <input type="text" placeholder="0" inputmode="numeric" class="disc-input w-full p-1.5 text-base font-bold bg-transparent text-right outline-none min-w-0" oninput="formatAndCalc(this, '${planId}')">
                    <select class="disc-unit bg-slate-200 dark:bg-slate-700 text-[10px] font-bold p-1.5 outline-none border-l dark:border-slate-600" onchange="syncDown('${planId}')">
                        <option value="amt">‡∏ø</option>
                        <option value="pct">%</option>
                    </select>
                </div>
                <button onclick="this.parentElement.remove(); syncDown('${planId}')" class="text-red-400 px-1 text-base shrink-0">‚úï</button>
            `;
            container.appendChild(div);
        }

        function toggleComparison() {
            const container = document.getElementById('plan2-container');
            if (container.classList.contains('hidden')) {
                document.getElementById('plan2').className = document.getElementById('plan1').className;
                document.getElementById('plan2').innerHTML = document.getElementById('plan1').innerHTML.replace(/plan1/g, 'plan2').replace('‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà 1', '‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà 2');
                container.classList.remove('hidden');
                setTimeout(() => container.style.opacity = "1", 10);
                calc('plan2');
            } else { container.classList.add('hidden'); }
            document.getElementById('btn-compare-text').innerText = container.classList.contains('hidden') ? "+ ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö" : "‚úï ‡∏õ‡∏¥‡∏î";
        }

        function toggleDarkMode() { document.documentElement.classList.toggle('dark'); }
    </script>
</body>
</html>