<!DOCTYPE html>
<html lang="th" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Car Loan Pro - No Auto Zoom</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <script>tailwind.config = { darkMode: 'class' }</script>
    <style>
        body { font-family: 'Kanit', sans-serif; -webkit-tap-highlight-color: transparent; }
        .glass { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(12px); }
        .dark .glass { background: rgba(15, 23, 42, 0.9); }
        /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡∏π‡∏°‡πÇ‡∏î‡∏¢‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏ä‡πà‡∏≠‡∏á input ‡πÄ‡∏õ‡πá‡∏ô 16px */
        input, select, textarea { font-size: 16px !important; }
        input:focus { outline: none; border-bottom-color: #3b82f6 !important; }
        input::placeholder { color: #cbd5e1; opacity: 0.8; }
        .dark input::placeholder { color: #475569; }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 min-h-screen pb-20">

    <nav class="sticky top-0 z-40 glass border-b border-slate-200 dark:border-slate-800 p-4 flex justify-between items-center">
        <div class="flex items-center gap-2"><span class="text-2xl">üèéÔ∏è</span><span class="font-bold text-lg">Car Loan Pro</span></div>
        <button onclick="toggleComparison()" class="bg-blue-600 text-white px-5 py-2 rounded-2xl text-xs font-bold shadow-lg">
            <span id="btn-compare-text">+ ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</span>
        </button>
    </nav>

    <main class="max-w-4xl mx-auto p-4 space-y-6">
        <div id="plan1" class="glass rounded-[2.5rem] p-6 border border-slate-200 dark:border-slate-800 shadow-xl space-y-6">
            <div class="flex justify-between items-center">
                <span class="px-3 py-1 bg-blue-100 dark:bg-blue-900/40 text-blue-600 text-[10px] font-bold rounded-lg uppercase">‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà 1</span>
                <input type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∏‡πà‡∏ô‡∏£‡∏ñ..." class="bg-transparent border-b border-dashed text-right text-sm outline-none w-1/2">
            </div>

            <div class="grid gap-6">
                <div class="space-y-1">
                    <label class="text-[10px] font-bold text-slate-400 uppercase">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå</label>
                    <input type="text" data-id="price" placeholder="0" oninput="formatAndCalc(this, 'plan1')" inputmode="numeric" class="w-full bg-transparent text-4xl font-bold border-b-2 border-slate-100 dark:border-slate-800 pb-1">
                </div>

                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <label class="text-xs font-bold text-green-600 uppercase">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</label>
                        <button onclick="addDiscount('plan1')" class="text-[10px] bg-green-500 text-white px-3 py-1 rounded-full font-bold shadow-sm">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
                    </div>
                    <div data-id="discount-list" class="space-y-2"></div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-slate-100 dark:bg-slate-900/50 p-4 rounded-3xl space-y-2 border border-transparent focus-within:border-blue-500">
                        <label class="text-[10px] font-bold text-slate-400 uppercase">‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå</label>
                        <input type="text" data-id="down" placeholder="0" oninput="autoSetCustom('plan1'); formatAndCalc(this, 'plan1')" inputmode="numeric" class="w-full bg-transparent font-bold text-lg">
                        <select data-id="down_percent" onchange="syncDown('plan1')" class="bg-transparent text-blue-600 text-[10px] font-bold outline-none">
                            <option value="custom" selected>‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏≠‡∏á</option>
                            <option value="15">15%</option>
                            <option value="20">20%</option>
                            <option value="25">25%</option>
                            <option value="30">30%</option>
                        </select>
                    </div>
                    
                    <div class="bg-slate-100 dark:bg-slate-900/50 p-4 rounded-3xl space-y-2 border border-transparent focus-within:border-blue-500">
                        <label class="text-[10px] font-bold text-slate-400 uppercase">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ú‡πà‡∏≠‡∏ô</label>
                        <select data-id="years" onchange="calc('plan1')" class="w-full bg-transparent font-bold text-lg mt-1 outline-none">
                            <option value="0" selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ...</option>
                            <option value="4">4 ‡∏õ‡∏µ (48 ‡∏á‡∏ß‡∏î)</option>
                            <option value="5">5 ‡∏õ‡∏µ (60 ‡∏á‡∏ß‡∏î)</option>
                            <option value="6">6 ‡∏õ‡∏µ (72 ‡∏á‡∏ß‡∏î)</option>
                            <option value="7">7 ‡∏õ‡∏µ (84 ‡∏á‡∏ß‡∏î)</option>
                            <option value="8">8 ‡∏õ‡∏µ (96 ‡∏á‡∏ß‡∏î)</option>
                        </select>
                    </div>

                    <div class="bg-slate-100 dark:bg-slate-900/50 p-4 rounded-3xl space-y-2 border border-transparent focus-within:border-blue-500">
                        <label class="text-[10px] font-bold text-slate-400 uppercase">‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢/‡∏õ‡∏µ (%)</label>
                        <input type="text" data-id="interest" placeholder="0.00" oninput="calc('plan1')" inputmode="decimal" class="w-full bg-transparent font-bold text-lg">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div class="flex items-center justify-between p-4 bg-orange-50 dark:bg-orange-950/20 rounded-2xl border border-orange-100 dark:border-orange-900/30">
                        <div class="flex-1">
                            <label class="text-[10px] font-bold text-orange-600 uppercase">‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô PPI</label>
                            <input type="text" data-id="insurance" placeholder="0" oninput="formatAndCalc(this, 'plan1')" inputmode="numeric" class="bg-transparent font-bold w-full text-lg">
                        </div>
                        <label class="flex items-center gap-2 text-[10px] font-bold text-orange-600 cursor-pointer">
                            <input type="checkbox" data-id="inc_ins" onchange="calc('plan1')"> <span>‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î‡∏Å‡∏π‡πâ</span>
                        </label>
                    </div>
                    <label class="flex items-center p-4 bg-blue-50 dark:bg-blue-950/20 rounded-2xl border border-blue-100 dark:border-blue-900/30 cursor-pointer text-xs font-bold text-slate-600 dark:text-slate-300">
                        <input type="checkbox" data-id="add_vat" onchange="calc('plan1')" class="mr-3">
                        <span>‡∏ö‡∏ß‡∏Å‡∏†‡∏≤‡∏©‡∏µ VAT 7% ‡πÉ‡∏ô‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î</span>
                    </label>
                </div>
            </div>

            <div class="bg-slate-900 dark:bg-blue-700 p-8 rounded-[2.5rem] text-white shadow-2xl space-y-5">
                <div class="text-center">
                    <p class="text-[10px] text-slate-400 dark:text-blue-100 uppercase mb-1 tracking-widest">‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</p>
                    <p class="text-5xl md:text-6xl font-black mb-1"><span data-id="res-monthly">0</span></p>
                    <p class="text-[10px] text-slate-400 dark:text-blue-200">
                        <span data-id="res-period">0</span> ‡∏á‡∏ß‡∏î | <span data-id="res-vattxt">‡∏£‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                    </p>
                </div>

                <div class="grid grid-cols-2 gap-y-4 gap-x-6 pt-5 border-t border-white/10">
                    <div>
                        <p class="text-[10px] text-slate-400 mb-1 uppercase">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ñ‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô</p>
                        <p data-id="res-rawprice" class="font-bold text-sm text-slate-300">0</p>
                    </div>
                    <div class="text-right">
                        <p class="text-[10px] text-green-400 mb-1 uppercase">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                        <p data-id="res-disctotal" class="font-bold text-lg text-green-400">0</p>
                    </div>
                    <div class="col-span-2 py-2 px-4 bg-white/5 rounded-2xl flex justify-between items-center border border-white/5">
                        <p class="text-[10px] text-blue-200 uppercase font-bold">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</p>
                        <p data-id="res-netprice" class="font-bold text-lg text-blue-200">0</p>
                    </div>
                    <div>
                        <p class="text-[10px] text-slate-400 mb-1 uppercase">‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</p>
                        <p data-id="res-netdown" class="font-bold text-lg text-green-400">0</p>
                    </div>
                    <div class="text-right">
                        <p class="text-[10px] text-slate-400 mb-1 uppercase">‡∏¢‡∏≠‡∏î‡∏Å‡∏π‡πâ (‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏°‡∏î‡∏≠‡∏Å)</p>
                        <p data-id="res-loan" class="font-bold text-lg">0</p>
                    </div>
                    <div>
                        <p class="text-[10px] text-yellow-500 mb-1 uppercase">‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏±‡∏ç‡∏ç‡∏≤</p>
                        <p data-id="res-int" class="font-bold text-lg text-yellow-500">0</p>
                    </div>
                    <div class="text-right">
                        <p class="text-[10px] text-orange-400 mb-1 uppercase font-bold">‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô</p>
                        <p data-id="res-totalall" class="font-bold text-xl text-orange-400">0</p>
                    </div>
                </div>
            </div>
        </div>
        <div id="plan2-container" class="hidden opacity-0 transition-all duration-300"><div id="plan2"></div></div>
    </main>

    <nav class="fixed bottom-6 left-1/2 -translate-x-1/2 h-16 glass rounded-2xl border border-slate-200 dark:border-slate-800 flex items-center px-8 gap-8 shadow-2xl z-40">
        <button onclick="toggleDarkMode()" class="text-xl">üåì</button>
        <button onclick="location.reload()" class="text-red-500 text-xs font-bold uppercase">Reset</button>
    </nav>

    <script>
        const parse = (s) => parseFloat(s.toString().replace(/,/g, '')) || 0;
        const fmt = (n) => (isNaN(n) || n === 0) ? "0" : Math.round(n).toLocaleString();

        function formatAndCalc(el, planId) {
            let cursorPosition = el.selectionStart;
            let originalLength = el.value.length;
            let val = el.value.replace(/,/g, '');
            if (!isNaN(val) && val !== '') el.value = Number(val).toLocaleString();
            let newLength = el.value.length;
            el.selectionEnd = cursorPosition + (newLength - originalLength);
            if (el.dataset.id === 'price') syncDown(planId);
            calc(planId);
        }

        function syncDown(planId) {
            const p = document.getElementById(planId);
            const price = parse(p.querySelector('[data-id="price"]').value);
            const dpValue = p.querySelector('[data-id="down_percent"]').value;
            const downInput = p.querySelector('[data-id="down"]');
            
            let discTotal = 0;
            p.querySelectorAll('.disc-row').forEach(row => {
                const input = row.querySelector('.disc-input');
                const unit = row.querySelector('.disc-unit').value;
                discTotal += (unit === 'pct') ? (price * (parse(input.value) / 100)) : parse(input.value);
            });

            if (dpValue !== 'custom' && price > 0) {
                downInput.value = fmt((price - discTotal) * (parseFloat(dpValue) / 100));
            }
            calc(planId);
        }

        function autoSetCustom(planId) {
            document.querySelector(`#${planId} [data-id="down_percent"]`).value = 'custom';
        }

        function calc(planId) {
            const p = document.getElementById(planId);
            if(!p) return;
            const price = parse(p.querySelector('[data-id="price"]').value);
            const down = parse(p.querySelector('[data-id="down"]').value);
            const intr = parse(p.querySelector('[data-id="interest"]').value);
            const yrs = parseInt(p.querySelector('[data-id="years"]').value);
            const ins = parse(p.querySelector('[data-id="insurance"]').value);
            const incIns = p.querySelector('[data-id="inc_ins"]').checked;
            const addVat = p.querySelector('[data-id="add_vat"]').checked;

            let discTotal = 0;
            p.querySelectorAll('.disc-row').forEach(row => {
                const input = row.querySelector('.disc-input');
                const unit = row.querySelector('.disc-unit').value;
                discTotal += (unit === 'pct') ? (price * (parse(input.value) / 100)) : parse(input.value);
            });

            const netPrice = price - discTotal;
            let loan = netPrice - down;
            if (incIns) loan += ins;
            
            const months = yrs * 12;
            let monthly = 0, totalInt = 0;
            if (months > 0 && loan > 0) {
                totalInt = loan * (intr/100) * yrs;
                monthly = (loan + totalInt) / months;
            }

            let vatAmount = 0;
            if (addVat) {
                vatAmount = monthly * 0.07;
                monthly += vatAmount;
            }

            p.querySelector('[data-id="res-monthly"]').innerText = fmt(monthly);
            p.querySelector('[data-id="res-period"]').innerText = months || 0;
            p.querySelector('[data-id="res-vattxt"]').innerText = addVat ? `‡∏£‡∏ß‡∏° VAT 7% (${fmt(vatAmount)}.-)` : (price > 0 ? "‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏° VAT" : "‡∏£‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
            p.querySelector('[data-id="res-rawprice"]').innerText = fmt(price);
            p.querySelector('[data-id="res-disctotal"]').innerText = fmt(discTotal);
            p.querySelector('[data-id="res-netprice"]').innerText = fmt(netPrice);
            p.querySelector('[data-id="res-loan"]').innerText = fmt(loan);
            p.querySelector('[data-id="res-netdown"]').innerText = fmt(down);
            p.querySelector('[data-id="res-int"]').innerText = fmt(totalInt);
            p.querySelector('[data-id="res-totalall"]').innerText = fmt(down + (monthly * (months || 0)));
        }

        function addDiscount(planId) {
            const container = document.querySelector(`#${planId} [data-id="discount-list"]`);
            const div = document.createElement('div');
            div.className = "disc-row flex gap-2 items-center bg-white/50 dark:bg-slate-900/50 p-2 rounded-2xl border border-slate-200 dark:border-slate-800";
            div.innerHTML = `
                <input type="text" placeholder="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£..." class="flex-1 bg-transparent text-base outline-none px-2">
                <div class="flex items-center bg-slate-100 dark:bg-slate-800 rounded-xl overflow-hidden border dark:border-slate-700">
                    <input type="text" placeholder="0" inputmode="numeric" class="disc-input w-24 p-2 text-base font-bold bg-transparent text-right outline-none" oninput="formatAndCalc(this, '${planId}')">
                    <select class="disc-unit bg-slate-200 dark:bg-slate-700 text-sm font-bold p-2 outline-none border-l dark:border-slate-600" onchange="syncDown('${planId}')">
                        <option value="amt">‡∏ø</option>
                        <option value="pct">%</option>
                    </select>
                </div>
                <button onclick="this.parentElement.remove(); syncDown('${planId}')" class="text-red-400 px-2 text-xl">‚úï</button>
            `;
            container.appendChild(div);
        }

        function toggleComparison() {
            const container = document.getElementById('plan2-container');
            if (container.classList.contains('hidden')) {
                document.getElementById('plan2').className = document.getElementById('plan1').className;
                document.getElementById('plan2').innerHTML = document.getElementById('plan1').innerHTML.replace(/plan1/g, 'plan2').replace('‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà 1', '‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà 2');
                container.classList.remove('hidden');
                setTimeout(() => container.style.opacity = "1", 10);
                calc('plan2');
            } else { container.classList.add('hidden'); }
            document.getElementById('btn-compare-text').innerText = container.classList.contains('hidden') ? "+ ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö" : "‚úï ‡∏õ‡∏¥‡∏î‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö";
        }

        function toggleDarkMode() { document.documentElement.classList.toggle('dark'); }
    </script>
</body>
</html>