<!DOCTYPE html>
<html lang="th" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Car Loan Pro - Split Fields</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <script>tailwind.config = { darkMode: 'class' }</script>
    <style>
        body { font-family: 'Kanit', sans-serif; -webkit-tap-highlight-color: transparent; }
        .glass { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(12px); }
        .dark .glass { background: rgba(15, 23, 42, 0.9); }
        .active-field { ring: 3px solid #3b82f6 !important; background: #eff6ff !important; }
        .dark .active-field { background: #1e293b !important; }
        #keypad { transform: translateY(100%); transition: transform 0.3s ease-out; z-index: 1000; }
        #keypad.show { transform: translateY(0); }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 min-h-screen pb-40">

    <nav class="sticky top-0 z-40 glass border-b border-slate-200 dark:border-slate-800 p-4 flex justify-between items-center">
        <div class="flex items-center gap-2"><span class="text-2xl">üèéÔ∏è</span><span class="font-bold text-lg">Car Loan Pro</span></div>
        <button onclick="toggleComparison()" class="bg-blue-600 text-white px-5 py-2 rounded-2xl text-xs font-bold shadow-lg">
            <span id="btn-compare-text">+ ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</span>
        </button>
    </nav>

    <main class="max-w-4xl mx-auto p-4 space-y-6">
        <div id="plan1" class="glass rounded-[2.5rem] p-6 border border-slate-200 dark:border-slate-800 shadow-xl space-y-6">
            <div class="flex justify-between items-center">
                <span class="px-3 py-1 bg-blue-100 dark:bg-blue-900/40 text-blue-600 text-[10px] font-bold rounded-lg uppercase">‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà 1</span>
                <input type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∏‡πà‡∏ô‡∏£‡∏ñ..." class="bg-transparent border-b border-dashed text-right text-xs outline-none w-1/2">
            </div>

            <div class="grid gap-6">
                <div class="space-y-1">
                    <label class="text-[10px] font-bold text-slate-400 uppercase">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå</label>
                    <input type="text" data-id="price" data-type="num" value="1,000,000" oninput="formatInput(this); syncDown('plan1')" class="w-full bg-transparent text-4xl font-bold outline-none border-b-2 border-slate-100 dark:border-slate-800 focus:border-blue-500 pb-1">
                </div>

                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <label class="text-xs font-bold text-green-600 uppercase">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</label>
                        <button onclick="addDiscount('plan1')" class="text-[10px] bg-green-500 text-white px-3 py-1 rounded-full font-bold">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                    </div>
                    <div data-id="discount-list" class="space-y-2"></div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-slate-100 dark:bg-slate-900/50 p-4 rounded-3xl space-y-2">
                        <label class="text-[10px] font-bold text-slate-400 uppercase">‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå</label>
                        <input type="text" data-id="down" data-type="num" value="200,000" oninput="autoSetCustom('plan1'); formatInput(this); calc('plan1')" class="w-full bg-transparent font-bold text-lg outline-none">
                        <select data-id="down_percent" onchange="syncDown('plan1')" class="bg-transparent text-blue-600 text-[10px] font-bold outline-none">
                            <option value="custom">‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏≠‡∏á</option>
                            <option value="15">15%</option>
                            <option value="20" selected>20%</option>
                            <option value="25">25%</option>
                        </select>
                    </div>
                    
                    <div class="bg-slate-100 dark:bg-slate-900/50 p-4 rounded-3xl space-y-2">
                        <label class="text-[10px] font-bold text-slate-400 uppercase">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ú‡πà‡∏≠‡∏ô</label>
                        <select data-id="years" onchange="calc('plan1')" class="w-full bg-transparent font-bold text-lg outline-none mt-1">
                            <option value="4">4 ‡∏õ‡∏µ (48 ‡∏á‡∏ß‡∏î)</option>
                            <option value="5" selected>5 ‡∏õ‡∏µ (60 ‡∏á‡∏ß‡∏î)</option>
                            <option value="6">6 ‡∏õ‡∏µ (72 ‡∏á‡∏ß‡∏î)</option>
                            <option value="7">7 ‡∏õ‡∏µ (84 ‡∏á‡∏ß‡∏î)</option>
                            <option value="8">8 ‡∏õ‡∏µ (96 ‡∏á‡∏ß‡∏î)</option>
                        </select>
                        <p class="text-[10px] text-slate-400 font-bold uppercase">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡∏µ</p>
                    </div>

                    <div class="bg-slate-100 dark:bg-slate-900/50 p-4 rounded-3xl space-y-2">
                        <label class="text-[10px] font-bold text-slate-400 uppercase">‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏Ñ‡∏á‡∏ó‡∏µ‡πà/‡∏õ‡∏µ (%)</label>
                        <input type="text" data-id="interest" data-type="num" value="2.5" oninput="calc('plan1')" class="w-full bg-transparent font-bold text-lg outline-none">
                        <p class="text-[10px] text-orange-500 font-bold uppercase">Flat Rate</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div class="flex items-center justify-between p-4 bg-orange-50 dark:bg-orange-950/20 rounded-2xl border border-orange-100 dark:border-orange-900/30">
                        <div class="flex-1">
                            <label class="text-[10px] font-bold text-orange-600 uppercase">‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô PPI</label>
                            <input type="text" data-id="insurance" data-type="num" value="0" oninput="formatInput(this); calc('plan1')" class="bg-transparent font-bold w-full outline-none text-lg">
                        </div>
                        <label class="flex items-center gap-2 text-[10px] font-bold text-orange-600 cursor-pointer">
                            <input type="checkbox" data-id="inc_ins" onchange="calc('plan1')"> <span>‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î‡∏Å‡∏π‡πâ</span>
                        </label>
                    </div>
                    <label class="flex items-center p-4 bg-blue-50 dark:bg-blue-950/20 rounded-2xl border border-blue-100 dark:border-blue-900/30 cursor-pointer text-xs font-bold text-slate-600 dark:text-slate-300">
                        <input type="checkbox" data-id="add_vat" onchange="calc('plan1')" class="mr-3">
                        <span>‡∏ö‡∏ß‡∏Å‡∏†‡∏≤‡∏©‡∏µ VAT 7% ‡πÉ‡∏ô‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î</span>
                    </label>
                </div>
            </div>

            <div class="bg-slate-900 dark:bg-blue-700 p-8 rounded-[2.5rem] text-white shadow-2xl space-y-6">
                <div class="text-center">
                    <p class="text-[10px] text-slate-400 dark:text-blue-100 uppercase mb-1 tracking-widest">‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</p>
                    <p class="text-6xl font-black mb-1"><span data-id="res-monthly">0</span></p>
                    <p class="text-[10px] text-slate-400 dark:text-blue-200">
                        <span data-id="res-period">60</span> ‡∏á‡∏ß‡∏î | <span data-id="res-vattxt"></span>
                    </p>
                </div>

                <div class="grid grid-cols-2 gap-4 pt-4 border-t border-white/10">
                    <div class="space-y-4">
                        <div>
                            <p class="text-[10px] text-slate-400 mb-1 uppercase">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ñ‡∏´‡∏±‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</p>
                            <p data-id="res-netprice" class="font-bold text-lg text-blue-300">0</p>
                        </div>
                        <div>
                            <p class="text-[10px] text-slate-400 mb-1 uppercase">‡∏¢‡∏≠‡∏î‡∏à‡∏±‡∏î/‡∏¢‡∏≠‡∏î‡∏Å‡∏π‡πâ</p>
                            <p data-id="res-loan" class="font-bold text-lg">0</p>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <p class="text-[10px] text-slate-400 mb-1 uppercase text-right">‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</p>
                            <p data-id="res-netdown" class="font-bold text-lg text-right text-green-400">0</p>
                        </div>
                        <div>
                            <p class="text-[10px] text-slate-400 mb-1 uppercase text-right">‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏£‡∏ß‡∏°‡∏ï‡∏•‡∏≠‡∏î‡∏™‡∏±‡∏ç‡∏ç‡∏≤</p>
                            <p data-id="res-int" class="font-bold text-lg text-right text-yellow-400">0</p>
                        </div>
                    </div>
                </div>

                <div class="pt-4 border-t border-white/10 flex justify-between items-center">
                    <div>
                        <p class="text-[10px] text-slate-400 uppercase font-bold">‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô (Total Cost)</p>
                        <p class="text-[10px] text-slate-400 leading-none">‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå + ‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î‡∏ó‡∏∏‡∏Å‡∏á‡∏ß‡∏î</p>
                    </div>
                    <p data-id="res-totalall" class="text-3xl font-black text-orange-400">0</p>
                </div>
            </div>
        </div>
        <div id="plan2-container" class="hidden opacity-0 transition-all duration-300"><div id="plan2"></div></div>
    </main>

    <div id="keypad" class="fixed bottom-0 left-0 right-0 glass rounded-t-[2.5rem] p-6 shadow-2xl md:hidden">
        <div class="grid grid-cols-3 gap-3 max-w-sm mx-auto">
            <button onclick="kpPress('1')" class="h-14 bg-white dark:bg-slate-800 rounded-2xl text-xl font-bold">1</button>
            <button onclick="kpPress('2')" class="h-14 bg-white dark:bg-slate-800 rounded-2xl text-xl font-bold">2</button>
            <button onclick="kpPress('3')" class="h-14 bg-white dark:bg-slate-800 rounded-2xl text-xl font-bold">3</button>
            <button onclick="kpPress('4')" class="h-14 bg-white dark:bg-slate-800 rounded-2xl text-xl font-bold">4</button>
            <button onclick="kpPress('5')" class="h-14 bg-white dark:bg-slate-800 rounded-2xl text-xl font-bold">5</button>
            <button onclick="kpPress('6')" class="h-14 bg-white dark:bg-slate-800 rounded-2xl text-xl font-bold">6</button>
            <button onclick="kpPress('7')" class="h-14 bg-white dark:bg-slate-800 rounded-2xl text-xl font-bold">7</button>
            <button onclick="kpPress('8')" class="h-14 bg-white dark:bg-slate-800 rounded-2xl text-xl font-bold">8</button>
            <button onclick="kpPress('9')" class="h-14 bg-white dark:bg-slate-800 rounded-2xl text-xl font-bold">9</button>
            <button onclick="kpPress('.')" class="h-14 bg-white dark:bg-slate-800 rounded-2xl text-xl font-bold">.</button>
            <button onclick="kpPress('0')" class="h-14 bg-white dark:bg-slate-800 rounded-2xl text-xl font-bold">0</button>
            <button onclick="kpPress('del')" class="h-14 bg-red-50 text-red-500 rounded-2xl text-lg font-bold">‚å´</button>
            <button onclick="kpClose()" class="col-span-3 h-14 bg-blue-600 text-white rounded-2xl font-bold mt-2">‡∏ï‡∏Å‡∏•‡∏á (Done)</button>
        </div>
    </div>

    <script>
        let activeInput = null;
        const isMobile = () => /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        const parse = (s) => parseFloat(s.toString().replace(/,/g, '')) || 0;
        const fmt = (n) => isNaN(n) ? "0" : Math.round(n).toLocaleString();

        function formatInput(el) {
            let val = el.value.replace(/,/g, '');
            if (!isNaN(val) && val !== '') el.value = Number(val).toLocaleString();
        }

        function toggleDiscUnit(btn, planId) {
            const row = btn.closest('.disc-row');
            const input = row.querySelector('.disc-input');
            const price = parse(document.querySelector(`#${planId} [data-id="price"]`).value);
            let val = parse(input.value);
            if (btn.innerText === '‡∏ø') {
                btn.innerText = '%';
                btn.className = "w-10 h-8 rounded-lg bg-blue-500 text-white text-xs font-bold";
                if (price > 0) input.value = ((val / price) * 100).toFixed(2);
                input.dataset.unit = 'pct';
            } else {
                btn.innerText = '‡∏ø';
                btn.className = "w-10 h-8 rounded-lg bg-green-500 text-white text-xs font-bold";
                if (price > 0) input.value = fmt(price * (val / 100));
                input.dataset.unit = 'amt';
            }
            syncDown(planId);
        }

        function autoSetCustom(planId) {
            document.querySelector(`#${planId} [data-id="down_percent"]`).value = 'custom';
        }

        function calc(planId) {
            const p = document.getElementById(planId);
            if(!p) return;
            
            const price = parse(p.querySelector('[data-id="price"]').value);
            const down = parse(p.querySelector('[data-id="down"]').value);
            const intr = parse(p.querySelector('[data-id="interest"]').value);
            const yrs = parseInt(p.querySelector('[data-id="years"]').value);
            const ins = parse(p.querySelector('[data-id="insurance"]').value);
            const incIns = p.querySelector('[data-id="inc_ins"]').checked;
            const addVat = p.querySelector('[data-id="add_vat"]').checked;

            let discTotal = 0;
            p.querySelectorAll('.disc-row').forEach(row => {
                const input = row.querySelector('.disc-input');
                const val = parse(input.value);
                discTotal += (input.dataset.unit === 'pct') ? (price * (val / 100)) : val;
            });

            const netPrice = price - discTotal;
            let loan = netPrice - down;
            if (incIns) loan += ins;

            const totalInt = loan * (intr/100) * yrs;
            const totalLoanWithInt = loan + totalInt;
            const months = yrs * 12;
            
            let monthly = totalLoanWithInt / months;
            let vatAmount = 0;
            if (addVat) {
                vatAmount = monthly * 0.07;
                monthly += vatAmount;
            }

            const totalAllPay = down + (monthly * months);

            p.querySelector('[data-id="res-monthly"]').innerText = fmt(monthly);
            p.querySelector('[data-id="res-period"]').innerText = months;
            p.querySelector('[data-id="res-vattxt"]').innerText = addVat ? `‡∏£‡∏ß‡∏° VAT 7% (${fmt(vatAmount)}.-)` : "‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏° VAT";
            p.querySelector('[data-id="res-netprice"]').innerText = fmt(netPrice);
            p.querySelector('[data-id="res-loan"]').innerText = fmt(loan);
            p.querySelector('[data-id="res-netdown"]').innerText = fmt(down);
            p.querySelector('[data-id="res-int"]').innerText = fmt(totalInt);
            p.querySelector('[data-id="res-totalall"]').innerText = fmt(totalAllPay);
        }

        function syncDown(planId) {
            const p = document.getElementById(planId);
            const price = parse(p.querySelector('[data-id="price"]').value);
            const dp = p.querySelector('[data-id="down_percent"]').value;
            
            let discTotal = 0;
            p.querySelectorAll('.disc-row').forEach(row => {
                const input = row.querySelector('.disc-input');
                const val = parse(input.value);
                discTotal += (input.dataset.unit === 'pct') ? (price * (val / 100)) : val;
            });

            if (dp !== 'custom') {
                p.querySelector('[data-id="down"]').value = fmt((price - discTotal) * (parseFloat(dp)/100));
            }
            calc(planId);
        }

        function addDiscount(planId) {
            const container = document.querySelector(`#${planId} [data-id="discount-list"]`);
            const div = document.createElement('div');
            div.className = "disc-row flex gap-2 items-center bg-white/50 dark:bg-slate-900/50 p-2 rounded-2xl border border-slate-200 dark:border-slate-800";
            div.innerHTML = `
                <input type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î..." class="flex-1 bg-transparent text-xs outline-none px-2">
                <input type="text" data-type="num" data-unit="amt" placeholder="0" class="disc-input w-24 bg-slate-100 dark:bg-slate-800 p-2 rounded-xl text-xs font-bold outline-none text-right" oninput="if(this.dataset.unit==='amt') formatInput(this); syncDown('${planId}')">
                <button onclick="toggleDiscUnit(this, '${planId}')" class="w-10 h-8 rounded-lg bg-green-500 text-white text-xs font-bold">‡∏ø</button>
                <button onclick="this.parentElement.remove(); syncDown('${planId}')" class="text-red-400 px-1 text-lg">‚úï</button>
            `;
            container.appendChild(div);
        }

        document.addEventListener('focusin', (e) => {
            if (e.target.dataset.type === 'num') {
                activeInput = e.target;
                if (isMobile()) {
                    e.target.readOnly = true;
                    document.getElementById('keypad').classList.add('show');
                    e.target.classList.add('active-field');
                    setTimeout(() => e.target.scrollIntoView({ behavior: 'smooth', block: 'center' }), 300);
                }
            }
        });

        function kpPress(key) {
            if (!activeInput) return;
            let val = activeInput.value.replace(/,/g, '');
            if (key === 'del') val = val.slice(0, -1);
            else if (key === '.') { if (!val.includes('.')) val += '.'; }
            else val += key;
            const planId = activeInput.closest('[id^="plan"]').id;
            if (activeInput.dataset.id === 'down') autoSetCustom(planId);
            if (activeInput.dataset.unit === 'pct' || activeInput.dataset.id === 'interest') {
                activeInput.value = val;
            } else {
                activeInput.value = (val === '' || val === '.') ? val : Number(val).toLocaleString();
            }
            calc(planId);
        }

        function kpClose() {
            if (activeInput) activeInput.classList.remove('active-field');
            document.getElementById('keypad').classList.remove('show');
            activeInput = null;
        }

        function toggleComparison() {
            const container = document.getElementById('plan2-container');
            if (container.classList.contains('hidden')) {
                document.getElementById('plan2').className = document.getElementById('plan1').className;
                document.getElementById('plan2').innerHTML = document.getElementById('plan1').innerHTML.replace(/plan1/g, 'plan2').replace('‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà 1', '‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà 2');
                container.classList.remove('hidden');
                setTimeout(() => container.style.opacity = "1", 10);
                calc('plan2');
            } else { container.classList.add('hidden'); }
            document.getElementById('btn-compare-text').innerText = container.classList.contains('hidden') ? "+ ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö" : "‚úï ‡∏õ‡∏¥‡∏î‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö";
        }

        function toggleDarkMode() { document.documentElement.classList.toggle('dark'); }
        window.onload = () => calc('plan1');
    </script>
</body>
</html>